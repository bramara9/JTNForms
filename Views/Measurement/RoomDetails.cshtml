@model List<WindowDetails>
@{
    var cId = ViewBag.CutomerId;
    // var BlindTypes = ViewBag.BlindTypes;
    var CatalogTypes = ViewBag.CatalogTypes;
}

<div><b>User name : @ViewBag.userName </b></div>
<form id="frm" asp-controller="Measurement">
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <table id="MultiAddUserTable" class="table">
        <tr>
            <th>Room Name</th>
            <th>Catalog Name</th>
            <th>Fabric Name</th>
            @*<th>Base price</th>*@
            <th>Blind type</th>
        </tr>
        @if (Model != null)
        {
            @for (int i = 0; i < Model.Count(); i++)
            {
                var fabricNames = @Model[i].lstFabricNames;
                <input type="hidden" class="form-control" id="ItemSsection" asp-for="@Model[i].IsItemSelection">

                var CatalogId = "CatalogType" + @i;

                var FabricId = "FabricName" + @i;
                var BlindId = "BlindType" + @i;
                <tr>

                    <td>
                        <label class="form-check-label" asp-for="@Model[i].RoomName">@Model[i].RoomName</label>
                        <input type="hidden" class="form-control" id="hdnRoomName" asp-for="@Model[i].RoomName">
                    </td>
                    <td>
                        <select asp-for="@Model[i].CatalogType" id="@CatalogId" required class="form-select" onchange="showFabricName(this)">
                            <option value="">Select CatalogType</option>
                            @foreach (var typed in @CatalogTypes)
                            {
                                var seltedVal = (@typed.Value.Trim() == @Model[i].CatalogType?.Trim()) ? true : false;

                                <option value="@typed.Value" selected="@seltedVal">@typed.Text</option>
                            }
                        </select>
                        <br />
                        <span asp-validation-for="@Model[i].CatalogType" class="text-danger"></span>
                    </td>
                    <td>
                        <select asp-for="@Model[i].FabricName" id="@FabricId" required class="form-select" onchange="showBlindType(this)">
                            <option value="">Select Fabric</option>
                            @foreach (var typed in @fabricNames)
                            {
                                var seltedVal = (@typed.Value.Trim() == @Model[i].FabricName?.Trim()) ? true : false;

                                <option value="@typed.Value" selected="@seltedVal">@typed.Text</option>
                            }
                        </select>
                        <br />
                        <span asp-validation-for="@Model[i].FabricName" class="text-danger"></span>
                    </td>
                    @*  <td>
            <input id="Text3" type="text" asp-for="@Model[i].BasePrice" required class="form-control rounded" />
            <br /> <span asp-validation-for="@Model[i].BasePrice" class="text-danger"></span>
            </td>*@
                    <td>
                        <select id="@BlindId" asp-for="@Model[i].BlindType" required class="form-select">
                            <option value="">Select BlindType</option>
                            @foreach (var typed in @Model[i].lstBlindTypes)
                            {
                                var seltedVal = (@typed.Value.Trim() == @Model[i].BlindType?.Trim()) ? true : false;

                                <option value="@typed.Value" selected="@seltedVal">@typed.Text</option>
                            }
                        </select>
                        <br /><span asp-validation-for="@Model[i].BlindType" class="text-danger"></span>

                    </td>

                </tr>
            }
        }
    </table>

    <div class="row">
        <div class="col-12 col-md-6">
            <input id="btnBack" type="submit" class="btn btn-dark" formnovalidate value="Back" asp-action="Index" asp-route-customerId=@cId asp-route-coming="back" />

        </div>
        <div class="col-12 col-md-6" style="text-align:right;">
            <input id="btnSaveWindow" type="submit" class="btn btn-primary" value="Save And Next" asp-action="SaveRoomDetails" asp-route-customerId=@cId />
        </div>
    </div>
    <script type="text/javascript">
        function showFabricName(element) {
            var seletedTypeVal = $(element).val();
            // alert(seletedTypeVal);
            $('#' + element.id.replace('CatalogType', 'FabricName')).empty().append(new Option('Select', ''));
            $.ajax({
                url: '/Measurement/GetFabricNameByCatalogId',
                data: { "CatalogId": seletedTypeVal },
                dataType: "json",
                type: "GET",
                async: false,
                success: function (data) {
                    //debugger
                    for (var i = 0; i < data.length; i++) {
                        var opt = new Option(data[i].text, data[i].value);
                        $('#' + element.id.replace('CatalogType', 'FabricName')).append(opt);
                    }
                },
                error: function (xhr, textStatus, error) {
                    alert(xhr.statusText);
                },
                failure: function (response) {
                    alert("failure " + response.responseText);
                }
            });
        }
        function showBlindType(element) {
            var seletedTypeVal = $(element).val();
            var catelogname = $('#' + element.id.replace('FabricName', 'CatalogType')).val();
            // alert(seletedTypeVal);
            $('#' + element.id.replace('FabricName', 'BlindType')).empty().append(new Option('Select', ''));
            $.ajax({
                url: '/Measurement/GetBlindTypeByFabric',
                data: { "cateLogName": catelogname, "fabricName": seletedTypeVal },
                dataType: "json",
                type: "GET",
                async: false,
                success: function (data) {
                    //debugger
                    for (var i = 0; i < data.length; i++) {
                        var opt = new Option(data[i].text, data[i].value);
                        $('#' + element.id.replace('FabricName', 'BlindType')).append(opt);
                    }

                    if (data != null && data.length == 1) {
                        $('#' + element.id.replace('FabricName', 'BlindType')).val(data[0].value);
                    }
                },
                error: function (xhr, textStatus, error) {
                    alert(xhr.statusText);
                },
                failure: function (response) {
                    alert("failure " + response.responseText);
                }
            });
        }
    </script>

</form>